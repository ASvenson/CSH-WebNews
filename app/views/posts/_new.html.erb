<div id="dialog">
  <h2><%= params[:number] ? 'Post Reply' : 'Post New' %></h2>
  
  <%= form_for @new_post,
      :url => create_post_path, :html => { :method => 'post' }, :remote => true do |f| %>
    
    <% if @post %>
      <div class="form_element with_links">
        Replying to <a class="dialog_cancel minimize_draft"
          href="#!<%= post_path(@post.newsgroup_name, @post.number) %>"><%= @post.subject %></a>
      </div>
    <% end %>
    
    <div class="form_element">
      <%= f.label :newsgroup, 'Newsgroup:' %>
      <%= f.select :newsgroup, options_from_collection_for_select(@newsgroups, :name, :name,
        @post && @post.followup_newsgroup ? @post.followup_newsgroup.name : @newsgroup.name) %>
      <% if not @post %>
        <a id="crosspost_toggle" href="#"
          class="smallbutton toggle" data-selector=".crosspost_options">Cross-post...</a>
      <% end %>
    </div>
    <% if not @post %>
      <p class="explain close crosspost_options">
        (replies will go to this newsgroup)
      </p>
    <% end %>
    <% if @post and @post.followup_newsgroup %>
      <p class="explain close">
        (the author specified that replies should go to <%= @post.followup_newsgroup.name %>)
      </p>
    <% end %>
    
    <% if not @post %>
      <div class="form_element inline_inputs crosspost_options">
        <%= label_tag :crosspost_to, 'Cross-post to:' %>
        <%= select_tag :crosspost_to,
          options_from_collection_for_select(@newsgroups, :name, :name), :include_blank => true %>
        &mdash;
        <%= check_box_tag :crosspost_sysadmin %>
        <%= label_tag :crosspost_sysadmin, 'also to csh.lists.sysadmin' %>
        &mdash;
        <%= check_box_tag :crosspost_alumni %>
        <%= label_tag :crosspost_alumni, 'also to csh.lists.alumni' %>
      </div>
    <% end %>
    
    <div class="form_element">
      <%= f.text_field :subject, :placeholder => 'Subject' %>
    </div>
    
    <div class="form_element">
      <%= f.text_area :body, :rows => 25, :class => 'shrinkable' %>
    </div>
    <p class="explain close">
      Drafts are saved automatically in your browser's local storage. Saved drafts will not be available if you switch browsers or devices.
      <br>Need to reference long URLs? WebNews auto-links &quot;footnote&quot; style URL references.
      <a href="#" title="Show me how!" id="markup_explain_toggle"
        class="smallbutton explain_button toggle" data-selector="#link_markup_explain">?</a>
    </p>
    
    <% if @post %>
      <%= hidden_field_tag :reply_newsgroup, @post.newsgroup_name %>
      <%= hidden_field_tag :reply_number, @post.number %>
    <% end %>
    
    <p id="link_markup_explain">This is an example of using footnotes to reference web sites[1] or other news posts[2]. WebNews translates the inline numbers into clickable links when displaying the post.<br><br>[1] https://wiki.csh.rit.edu/wiki/News<br>[2] https://webnews.csh.rit.edu/#!/csh.noise/8487</p>
    
    <% if not @post and @current_user.admin? %>
      <fieldset>
        <legend><span class="role_badge">Admin</span></legend>
        <%= render :partial => 'sticky_fields', :locals => { :post => @new_post } %>
      </fieldset>
    <% end %>
    
    <div class="buttons">
      <%= f.submit 'Submit', :class => 'button green' %>
      <a href="#" class="button yellow dialog_cancel minimize_draft">Minimize</a>
      <a href="#" class="button red dialog_cancel clear_draft"
        data-confirm="Really abandon this post?">Abandon</a>
    </div>
  <% end %>
  
  <div class="loading"></div>
  <div class="errors"></div>
</div>
